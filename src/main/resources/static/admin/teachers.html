<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•™å¸ˆä¿¡æ¯å±•ç¤º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* åˆ†é¡µæ§ä»¶æ ·å¼ */
        .pagination-container {
            display: none;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            padding: 0 20px 20px;
        }

        .pagination-info {
            font-size: 14px;
            color: #666;
        }

        .pagination-controls {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .pagination-btn {
            padding: 6px 12px;
            border: 1px solid #d9d9d9;
            background-color: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .pagination-btn:hover:not(:disabled) {
            border-color: #1890ff;
            color: #1890ff;
        }

        .pagination-btn:disabled {
            cursor: not-allowed;
            color: #bfbfbf;
            background-color: #f5f5f5;
        }

        .pagination-btn.active {
            background-color: #1890ff;
            border-color: #1890ff;
            color: white;
        }

        .pagination-ellipsis {
            padding: 0 8px;
            color: #666;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background-color: #1890ff;
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .course-info {
            background-color: #f0f2f5;
            padding: 15px 20px;
            font-size: 14px;
            border-bottom: 1px solid #e8e8e8;
        }

        .course-info span {
            margin-right: 20px;
            color: #666;
        }

        .course-info strong {
            color: #333;
        }

        .content {
            padding: 20px;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            font-size: 16px;
            color: #666;
        }

        .empty-state {
            display: none;
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state i {
            font-size: 48px;
            margin-bottom: 16px;
            display: block;
        }

        .empty-state p {
            font-size: 16px;
        }

        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        th {
            background-color: #fafafa;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #333;
            border-bottom: 2px solid #e8e8e8;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid #f0f0f0;
            color: #666;
        }

        tr:hover {
            background-color: #f5f5f5;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            padding: 0 20px 20px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .btn-primary {
            background-color: #1890ff;
            color: white;
        }

        .btn-primary:hover {
            background-color: #40a9ff;
        }

        .btn-default {
            background-color: #f5f5f5;
            color: #333;
        }

        .btn-default:hover {
            background-color: #e8e8e8;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .header h1 {
                font-size: 20px;
            }

            .course-info {
                padding: 10px;
                font-size: 12px;
            }

            .course-info span {
                display: block;
                margin-right: 0;
                margin-bottom: 5px;
            }

            .content {
                padding: 15px;
            }

            th,
            td {
                padding: 8px;
                font-size: 12px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>æ•™å¸ˆä¿¡æ¯å±•ç¤º</h1>
        </div>
        <div class="course-info">
            <span><strong>å­¦æœŸ:</strong> <span id="currentSemester">--</span></span>
            <span><strong>è¯¾ç¨‹åç§°:</strong> <span id="currentCourseName">--</span></span>
        </div>
        <div class="content">
            <div id="loading" class="loading">åŠ è½½ä¸­ï¼Œè¯·ç¨å€™...</div>
            <div id="emptyState" class="empty-state">
                <i>ğŸ“š</i>
                <p>æš‚æ— æ•™å¸ˆä¿¡æ¯</p>
            </div>
            <div id="tableContainer" class="table-container" style="display: none;">
                <table id="teachersTable">
                    <thead>
                        <tr>
                            <th>åºå·</th>
                            <th>è¯¾ç¨‹ä»£ç </th>
                            <th>è¯¾ç¨‹åç§°</th>
                            <th>æ•™å¸ˆå§“å</th>
                            <th>èŒç§°</th>
                            <th>æ•™å­¦ç­</th>
                            <th>å¼€è¯¾éƒ¨é—¨</th>
                            <th>æ—¶é—´åœ°ç‚¹</th>
                            <th>å­¦åˆ†</th>
                            <th>è¯¾ç¨‹æ€§è´¨</th>
                            <th>æ ¡åŒº</th>
                        </tr>
                    </thead>
                    <tbody id="teachersTableBody">
                    </tbody>
                </table>
            </div>
            <!-- åˆ†é¡µæ§ä»¶ -->
            <div id="paginationContainer" class="pagination-container">
                <div class="pagination-info">
                    å…± <span id="totalItems">0</span> æ¡è®°å½•ï¼Œç¬¬ <span id="currentPage">1</span> / <span
                        id="totalPages">0</span> é¡µ
                </div>
                <div class="pagination-controls">
                    <button id="prevPageBtn" class="pagination-btn" disabled>ä¸Šä¸€é¡µ</button>
                    <div id="pageButtons" class="pagination-buttons"></div>
                    <button id="nextPageBtn" class="pagination-btn" disabled>ä¸‹ä¸€é¡µ</button>
                </div>
            </div>
        </div>
        <div class="action-buttons">
            <button id="backBtn" class="btn btn-default">è¿”å›è¯¾ç¨‹åˆ—è¡¨</button>
            <button id="refreshBtn" class="btn btn-primary">åˆ·æ–°æ•°æ®</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // è·å–DOMå…ƒç´ 
            const loading = document.getElementById('loading');
            const emptyState = document.getElementById('emptyState');
            const tableContainer = document.getElementById('tableContainer');
            const teachersTableBody = document.getElementById('teachersTableBody');
            const currentSemester = document.getElementById('currentSemester');
            const currentCourseName = document.getElementById('currentCourseName');
            const backBtn = document.getElementById('backBtn');
            const refreshBtn = document.getElementById('refreshBtn');

            // åˆ†é¡µç›¸å…³DOMå…ƒç´ 
            const paginationContainer = document.getElementById('paginationContainer');
            const totalItems = document.getElementById('totalItems');
            const currentPage = document.getElementById('currentPage');
            const totalPages = document.getElementById('totalPages');
            const prevPageBtn = document.getElementById('prevPageBtn');
            const nextPageBtn = document.getElementById('nextPageBtn');
            const pageButtons = document.getElementById('pageButtons');

            // åˆ†é¡µç›¸å…³å˜é‡
            let pageSize = 10; // æ¯é¡µæ˜¾ç¤º10æ¡è®°å½•
            let currentPageNum = 1;
            let totalRecords = 0;
            let allTeachers = []; // å­˜å‚¨æ‰€æœ‰æ•™å¸ˆæ•°æ®

            // è·å–URLå‚æ•°
            function getUrlParams() {
                const params = {};
                const urlParams = new URLSearchParams(window.location.search);
                for (const [key, value] of urlParams) {
                    params[key] = decodeURIComponent(value);
                }
                return params;
            }

            const params = getUrlParams();
            const semester = params.semester || '';
            const courseName = params.courseName || '';

            // æ˜¾ç¤ºå½“å‰è¯¾ç¨‹ä¿¡æ¯
            currentSemester.textContent = semester || 'æœªçŸ¥';
            currentCourseName.textContent = courseName || 'æœªçŸ¥';

            // åŠ è½½æ•™å¸ˆæ•°æ®
            function loadTeachers() {
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                loading.style.display = 'flex';
                emptyState.style.display = 'none';
                tableContainer.style.display = 'none';
                paginationContainer.style.display = 'none';
                teachersTableBody.innerHTML = '';

                // å¦‚æœå‚æ•°ä¸å®Œæ•´ï¼Œæ˜¾ç¤ºç©ºçŠ¶æ€
                if (!semester || !courseName) {
                    loading.style.display = 'none';
                    emptyState.style.display = 'block';
                    return;
                }

                // è°ƒç”¨APIè·å–æ•™å¸ˆæ•°æ®
                fetch(`/api/teachers/list?semester=${encodeURIComponent(semester)}&courseName=${encodeURIComponent(courseName)}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('ç½‘ç»œå“åº”é”™è¯¯');
                        }
                        return response.json();
                    })
                    .then(teachers => {
                        loading.style.display = 'none';

                        // å­˜å‚¨æ‰€æœ‰æ•™å¸ˆæ•°æ®
                        allTeachers = teachers || [];
                        totalRecords = allTeachers.length;

                        if (totalRecords === 0) {
                            emptyState.style.display = 'block';
                            return;
                        }

                        tableContainer.style.display = 'block';

                        // ä½¿ç”¨åˆ†é¡µå‡½æ•°æ¸²æŸ“æ•°æ®
                        renderTeachersWithPagination();
                    })
                    .catch(error => {
                        console.error('åŠ è½½æ•™å¸ˆæ•°æ®å¤±è´¥:', error);
                        loading.innerHTML = '<span style="color: #ff4d4f;">åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•</span>';
                    });
            }

            // æ¸²æŸ“åˆ†é¡µæŒ‰é’®
            function renderPagination() {
                if (totalRecords === 0) {
                    paginationContainer.style.display = 'none';
                    return;
                }

                paginationContainer.style.display = 'flex';

                const totalPagesNum = Math.ceil(totalRecords / pageSize);
                console.log('åˆ†é¡µä¿¡æ¯æ›´æ–°:', { totalRecords, pageSize, currentPageNum, totalPagesNum });

                // æ›´æ–°åˆ†é¡µä¿¡æ¯
                totalItems.textContent = totalRecords;
                currentPage.textContent = currentPageNum;
                totalPages.textContent = totalPagesNum;

                // æ›´æ–°ä¸Šä¸€é¡µ/ä¸‹ä¸€é¡µæŒ‰é’®çŠ¶æ€
                prevPageBtn.disabled = currentPageNum === 1;
                nextPageBtn.disabled = currentPageNum === totalPagesNum;

                // æ¸…ç©ºé¡µç æŒ‰é’®
                pageButtons.innerHTML = '';

                // ç”Ÿæˆåˆ†é¡µæŒ‰é’®ï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼Œæœ€å¤šæ˜¾ç¤º10ä¸ªé¡µç ï¼‰
                let startPage = Math.max(1, currentPageNum - 4);
                let endPage = Math.min(totalPagesNum, startPage + 9);

                // è°ƒæ•´èµ·å§‹é¡µç ï¼Œç¡®ä¿æ˜¾ç¤º10ä¸ªé¡µç ï¼ˆå¦‚æœæ€»é¡µæ•°è¶³å¤Ÿï¼‰
                if (endPage - startPage < 9 && startPage > 1) {
                    startPage = Math.max(1, endPage - 9);
                }

                // æ˜¾ç¤ºç¬¬ä¸€é¡µå’Œçœç•¥å·ï¼ˆå¦‚æœéœ€è¦ï¼‰
                if (startPage > 1) {
                    addPageButton(1);
                    if (startPage > 2) {
                        addEllipsis();
                    }
                }

                // æ˜¾ç¤ºä¸­é—´çš„é¡µç 
                for (let i = startPage; i <= endPage; i++) {
                    addPageButton(i);
                }

                // æ˜¾ç¤ºæœ€åä¸€é¡µå’Œçœç•¥å·ï¼ˆå¦‚æœéœ€è¦ï¼‰
                if (endPage < totalPagesNum) {
                    if (endPage < totalPagesNum - 1) {
                        addEllipsis();
                    }
                    addPageButton(totalPagesNum);
                }
            }

            // æ·»åŠ é¡µç æŒ‰é’®
            function addPageButton(pageNum) {
                const button = document.createElement('button');
                button.className = 'pagination-btn';
                button.textContent = pageNum;

                if (pageNum === currentPageNum) {
                    button.classList.add('active');
                }

                button.addEventListener('click', () => {
                    currentPageNum = pageNum;
                    renderTeachersWithPagination();
                });

                pageButtons.appendChild(button);
            }

            // æ·»åŠ çœç•¥å·
            function addEllipsis() {
                const ellipsis = document.createElement('span');
                ellipsis.className = 'pagination-ellipsis';
                ellipsis.textContent = '...';
                pageButtons.appendChild(ellipsis);
            }

            // åˆ†é¡µæ¸²æŸ“æ•™å¸ˆæ•°æ®
            function renderTeachersWithPagination() {
                const startIndex = (currentPageNum - 1) * pageSize;
                const endIndex = startIndex + pageSize;
                const currentPageTeachers = allTeachers.slice(startIndex, endIndex);
                console.log('æ¸²æŸ“ç¬¬', currentPageNum, 'é¡µæ•°æ®ï¼Œæ˜¾ç¤ºè®°å½•èŒƒå›´:', startIndex + 1, '-', endIndex, 'å…±', currentPageTeachers.length, 'æ¡è®°å½•');

                // æ¸…ç©ºè¡¨æ ¼å†…å®¹
                teachersTableBody.innerHTML = '';

                // æ¸²æŸ“å½“å‰é¡µçš„æ•°æ®
                currentPageTeachers.forEach((teacher, index) => {
                    const row = document.createElement('tr');
                    const displayIndex = startIndex + index + 1; // æ­£ç¡®çš„åºå·æ˜¾ç¤º
                    row.innerHTML = `
                        <td>${displayIndex}</td>
                        <td>${teacher.courseCode || '-'}</td>
                        <td>${teacher.courseName || '-'}</td>
                        <td>${teacher.teacher || '-'}</td>
                        <td>${teacher.title || '-'}</td>
                        <td>${teacher.teachingClass || '-'}</td>
                        <td>${teacher.department || '-'}</td>
                        <td>${teacher.timeLocation || '-'}</td>
                        <td>${teacher.credits || '-'}</td>
                        <td>${teacher.nature || '-'}</td>
                        <td>${teacher.campus || '-'}</td>
                    `;
                    teachersTableBody.appendChild(row);
                });

                // æ›´æ–°åˆ†é¡µæ§ä»¶
                renderPagination();
            }

            // åˆå§‹åŠ è½½æ•°æ®
            loadTeachers();

            // è¿”å›æŒ‰é’®äº‹ä»¶
            backBtn.addEventListener('click', () => {
                window.location.href = 'courses.html';
            });

            // åˆ·æ–°æŒ‰é’®äº‹ä»¶
            refreshBtn.addEventListener('click', () => {
                currentPageNum = 1; // åˆ·æ–°æ—¶é‡ç½®åˆ°ç¬¬ä¸€é¡µ
                loadTeachers();
            });

            // ä¸Šä¸€é¡µæŒ‰é’®äº‹ä»¶
            prevPageBtn.addEventListener('click', () => {
                if (currentPageNum > 1) {
                    currentPageNum--;
                    renderTeachersWithPagination();
                }
            });

            // ä¸‹ä¸€é¡µæŒ‰é’®äº‹ä»¶
            nextPageBtn.addEventListener('click', () => {
                const totalPagesNum = Math.ceil(totalRecords / pageSize);
                if (currentPageNum < totalPagesNum) {
                    currentPageNum++;
                    renderTeachersWithPagination();
                }
            });
        });
    </script>
</body>

</html>