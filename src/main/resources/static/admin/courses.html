<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯¾ç¨‹æ•°æ®å±•ç¤º - Wordæ–‡ä»¶ä¸Šä¼ å¤„ç†ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f7fa;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 24px;
            color: #1890ff;
            margin: 0;
        }

        .nav-btn {
            display: inline-block;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 500;
            text-align: center;
            cursor: pointer;
            border: none;
            border-radius: 4px;
            transition: all 0.3s;
            background-color: #1890ff;
            color: white;
            text-decoration: none;
        }

        .nav-btn:hover {
            background-color: #40a9ff;
        }

        .content-box {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }

        .toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #f0f0f0;
        }

        .toolbar h2 {
            font-size: 20px;
            color: #333;
        }

        .search-box {
            display: flex;
            align-items: center;
        }

        .search-input {
            padding: 8px 12px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            font-size: 14px;
            width: 200px;
            margin-right: 10px;
        }

        .search-input:focus {
            outline: none;
            border-color: #1890ff;
            box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2);
        }

        .btn {
            display: inline-block;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 500;
            text-align: center;
            cursor: pointer;
            border: none;
            border-radius: 4px;
            transition: all 0.3s;
        }

        .btn-primary {
            background-color: #1890ff;
            color: white;
        }

        .btn-primary:hover {
            background-color: #40a9ff;
        }

        .btn-default {
            background-color: #ffffff;
            color: #333;
            border: 1px solid #d9d9d9;
        }

        .btn-default:hover {
            border-color: #40a9ff;
            color: #40a9ff;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #f0f0f0;
        }

        .data-table th {
            background-color: #fafafa;
            font-weight: 600;
            color: #666;
        }

        .data-table tr {
            cursor: pointer;
            transition: all 0.3s;
        }

        .data-table tr:hover {
            background-color: #f5f5f5;
        }

        .data-table tr.clicked {
            background-color: #e6f7ff;
        }



        .pagination {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            margin-top: 20px;
        }

        .pagination-info {
            margin-right: 20px;
            color: #666;
            font-size: 14px;
        }

        .pagination-controls {
            display: flex;
            align-items: center;
        }

        .pagination-btn {
            width: 32px;
            height: 32px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0 4px;
            border: 1px solid #d9d9d9;
            background: white;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.3s;
        }

        .pagination-btn:hover:not(:disabled) {
            border-color: #40a9ff;
            color: #40a9ff;
        }

        .pagination-btn.active {
            background-color: #1890ff;
            color: white;
            border-color: #1890ff;
        }

        .pagination-btn:disabled {
            cursor: not-allowed;
            opacity: 0.5;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 60px 0;
        }

        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #1890ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .empty-state {
            text-align: center;
            padding: 60px 0;
            color: #999;
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }

        .empty-state-text {
            font-size: 16px;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>è¯¾ç¨‹æ•°æ®å±•ç¤º</h1>
            <div>
                <a href="./dashboard.html" class="nav-btn" style="margin-right: 10px;">è¿”å›æ§åˆ¶é¢æ¿</a>
                <a href="/admin/upload.html" class="nav-btn">è¿”å›ä¸Šä¼ é¡µé¢</a>
            </div>
        </div>

        <div class="content-box">
            <div class="toolbar">
                <h2>è¯¾ç¨‹åˆ—è¡¨</h2>
                <div class="search-box">
                    <select id="yearFilter" class="search-input" style="width: 120px; margin-right: 10px;">
                        <option value="">å…¨éƒ¨å¹´ä»½</option>
                        <option value="2020">2020å¹´</option>
                        <option value="2021">2021å¹´</option>
                        <option value="2022">2022å¹´</option>
                        <option value="2023">2023å¹´</option>
                        <option value="2024">2024å¹´</option>
                        <option value="2025">2025å¹´</option>
                    </select>
                    <input type="text" id="searchInput" class="search-input" placeholder="æœç´¢è¯¾ç¨‹åç§°" />
                    <button id="searchBtn" class="btn btn-primary">æœç´¢</button>
                    <button id="refreshBtn" class="btn btn-default">åˆ·æ–°</button>
                </div>
            </div>

            <div id="loading" class="loading">
                <div class="loading-spinner"></div>
                <span>æ­£åœ¨åŠ è½½è¯¾ç¨‹æ•°æ®ï¼Œè¯·ç¨å€™...</span>
            </div>

            <div id="emptyState" class="empty-state" style="display: none;">
                <div class="empty-state-icon">ğŸ“š</div>
                <div class="empty-state-text">æš‚æ— è¯¾ç¨‹æ•°æ®</div>
            </div>

            <div id="tableContainer" style="display: none;">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>åºå·</th>
                            <th>å¹´ä»½</th>
                            <th>è¯¾ç¨‹ç±»å‹</th>
                            <th>è¯¾ç¨‹åç§°</th>
                            <th>è¯¾ç¨‹æ€§è´¨</th>
                            <th>å­¦åˆ†</th>
                            <th>å®è·µå­¦åˆ†</th>
                            <th>å­¦æœŸ</th>
                            <th>å­¦é™¢</th>
                            <th>æŒ‡æ ‡ç‚¹</th>
                            <th>å¤‡æ³¨</th>
                        </tr>
                    </thead>
                    <tbody id="courseTableBody">
                        <!-- è¯¾ç¨‹æ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                    </tbody>
                </table>

                <div class="pagination">
                    <div class="pagination-info">å…± <span id="totalCount">0</span> æ¡æ•°æ®ï¼Œç¬¬ <span
                            id="currentPage">1</span>/<span id="totalPages">1</span> é¡µ</div>
                    <div class="pagination-controls">
                        <button id="prevPage" class="pagination-btn" disabled>&lt;</button>
                        <div id="pageButtons" style="display: flex;">
                            <!-- åˆ†é¡µæŒ‰é’®å°†åŠ¨æ€ç”Ÿæˆ -->
                        </div>
                        <button id="nextPage" class="pagination-btn" disabled>&gt;</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const loading = document.getElementById('loading');
            const emptyState = document.getElementById('emptyState');
            const tableContainer = document.getElementById('tableContainer');
            const courseTableBody = document.getElementById('courseTableBody');
            const totalCount = document.getElementById('totalCount');
            const currentPage = document.getElementById('currentPage');
            const totalPages = document.getElementById('totalPages');
            const prevPageBtn = document.getElementById('prevPage');
            const nextPageBtn = document.getElementById('nextPage');
            const pageButtons = document.getElementById('pageButtons');
            const searchInput = document.getElementById('searchInput');
            const yearFilter = document.getElementById('yearFilter');
            const searchBtn = document.getElementById('searchBtn');
            const refreshBtn = document.getElementById('refreshBtn');


            let allCourses = [];
            let filteredCourses = [];
            let currentPageNum = 1;
            const pageSize = 10; // æ¯é¡µæ˜¾ç¤º10æ¡æ•°æ®

            // åŠ è½½è¯¾ç¨‹æ•°æ®
            loadCourses();

            // åˆ·æ–°æŒ‰é’®äº‹ä»¶
            refreshBtn.addEventListener('click', () => {
                searchInput.value = '';
                yearFilter.value = '';
                currentPageNum = 1;
                loadCourses();
            });

            // æœç´¢æŒ‰é’®äº‹ä»¶
            searchBtn.addEventListener('click', () => {
                currentPageNum = 1;
                filterCourses();
            });

            // å¹´ä»½ç­›é€‰å˜åŒ–äº‹ä»¶
            yearFilter.addEventListener('change', () => {
                currentPageNum = 1;
                filterCourses();
            });

            // å›è½¦é”®æœç´¢
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    currentPageNum = 1;
                    filterCourses();
                }
            });

            // ä¸Šä¸€é¡µæŒ‰é’®äº‹ä»¶
            prevPageBtn.addEventListener('click', () => {
                if (currentPageNum > 1) {
                    currentPageNum--;
                    renderCoursesWithPagination();
                }
            });

            // ä¸‹ä¸€é¡µæŒ‰é’®äº‹ä»¶
            nextPageBtn.addEventListener('click', () => {
                const maxPage = Math.ceil(filteredCourses.length / pageSize);
                if (currentPageNum < maxPage) {
                    currentPageNum++;
                    renderCoursesWithPagination();
                }
            });

            function loadCourses() {
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                loading.style.display = 'flex';
                emptyState.style.display = 'none';
                tableContainer.style.display = 'none';

                // è°ƒç”¨APIè·å–è¯¾ç¨‹æ•°æ®
                fetch('/api/courses/all')
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('ç½‘ç»œå“åº”é”™è¯¯');
                        }
                        return response.json();
                    })
                    .then(courses => {
                        allCourses = courses;
                        filteredCourses = courses;
                        renderCoursesWithPagination();
                    })
                    .catch(error => {
                        console.error('åŠ è½½è¯¾ç¨‹æ•°æ®å¤±è´¥:', error);
                        loading.innerHTML = '<span style="color: #ff4d4f;">åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•</span>';
                    });
            }

            function renderCoursesWithPagination() {
                loading.style.display = 'none';

                // æ›´æ–°æ€»æ•°
                totalCount.textContent = filteredCourses.length;

                if (filteredCourses.length === 0) {
                    emptyState.style.display = 'block';
                    tableContainer.style.display = 'none';
                } else {
                    emptyState.style.display = 'none';
                    tableContainer.style.display = 'block';
                }

                // è®¡ç®—æ€»é¡µæ•°
                const maxPage = Math.ceil(filteredCourses.length / pageSize);

                // æ›´æ–°åˆ†é¡µä¿¡æ¯
                currentPage.textContent = currentPageNum;
                totalPages.textContent = maxPage;

                // å¯ç”¨/ç¦ç”¨åˆ†é¡µæŒ‰é’®
                prevPageBtn.disabled = currentPageNum === 1;
                nextPageBtn.disabled = currentPageNum === maxPage;

                // ç”Ÿæˆé¡µç æŒ‰é’®
                generatePageButtons(maxPage);

                // è®¡ç®—å½“å‰é¡µæ˜¾ç¤ºçš„æ•°æ®
                const startIndex = (currentPageNum - 1) * pageSize;
                const endIndex = Math.min(startIndex + pageSize, filteredCourses.length);
                const currentPageCourses = filteredCourses.slice(startIndex, endIndex);

                // æ¸²æŸ“å½“å‰é¡µçš„è¯¾ç¨‹æ•°æ®
                courseTableBody.innerHTML = '';
                currentPageCourses.forEach((course, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${startIndex + index + 1}</td>
                        <td>${course.year || '-'}</td>
                        <td>${course.courseType || '-'}</td>
                        <td>${course.courseName || '-'}</td>
                        <td>${course.nature || '-'}</td>
                        <td>${course.credits || '-'}</td>
                        <td>${course.practiceCredits || '-'}</td>
                        <td>${course.semester || '-'}</td>
                        <td>${course.school || '-'}</td>
                        <td>${course.indicators || '-'}</td>
                        <td>${course.notes || '-'}</td>
                    `;

                    // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                    row.addEventListener('click', function () {
                        // æ„å»ºå­¦æœŸæ ¼å¼: "2025-2026-1"
                        let semester;
                        if (course.year && course.semester) {
                            const year = parseInt(course.year); // å½“å‰å­¦å¹´
                            const semesterStr = course.semester; // å½“å‰å­¦æœŸå­—ç¬¦ä¸²ï¼Œå¦‚â€œç¬¬1å­¦æœŸâ€

                            // æå–å­¦æœŸç¼–å·
                            const semesterNum = semesterStr.match(/\d+/); // ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æå–æ•°å­—
                            if (!semesterNum) {
                                semester = '2025-2026-1'; // å¦‚æœæ— æ³•æå–å­¦æœŸç¼–å·ï¼Œä½¿ç”¨é»˜è®¤å€¼
                            } else {
                                const semesterNumber = parseInt(semesterNum[0]); // æå–çš„å­¦æœŸç¼–å·

                                let startYear;
                                let endYear;
                                let semesterIndex;

                                if (semesterNumber < 1 || semesterNumber > 8) {
                                    semester = '2025-2026-1';
                                } else {
                                    // è®¡ç®— startYear å’Œ endYear
                                    startYear = year + Math.floor((semesterNumber - 1) / 2);
                                    endYear = startYear + 1;

                                    // è®¡ç®— semesterIndex
                                    semesterIndex = (semesterNumber % 2) === 0 ? 2 : 1;

                                    semester = `${startYear}-${endYear}-${semesterIndex}`;
                                }
                            }
                        } else {
                            semester = '2025-2026-1'; // é»˜è®¤å€¼
                        }

                        // æå–è¯¾ç¨‹åç§°ä¸­çš„ä¸­æ–‡éƒ¨åˆ†
                        const extractChineseFromCourseName = (text) => {
                            if (!text) return '';
                            // ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æå–ä¸­æ–‡
                            const chinesePattern = /[\u4e00-\u9fa5]+/;
                            const match = text.match(chinesePattern);
                            return match ? match[0] : text;
                        };

                        const courseName = extractChineseFromCourseName(course.courseName || '');

                        // æ„å»ºURLå¹¶è·³è½¬
                        const teachersUrl = `/admin/teachers.html?semester=${encodeURIComponent(semester)}&courseName=${encodeURIComponent(courseName)}`;
                        window.location.href = teachersUrl;
                    });

                    courseTableBody.appendChild(row);
                });
            }

            // ç”Ÿæˆé¡µç æŒ‰é’®
            function generatePageButtons(maxPage) {
                pageButtons.innerHTML = '';

                // æ˜¾ç¤ºæœ€å¤š5ä¸ªé¡µç æŒ‰é’®
                let startPage = Math.max(1, currentPageNum - 2);
                let endPage = Math.min(maxPage, startPage + 4);

                // è°ƒæ•´èµ·å§‹é¡µç ï¼Œç¡®ä¿æ˜¾ç¤º5ä¸ªæŒ‰é’®
                if (endPage - startPage < 4) {
                    startPage = Math.max(1, endPage - 4);
                }

                // æ·»åŠ é¡µç æŒ‰é’®
                for (let i = startPage; i <= endPage; i++) {
                    const btn = document.createElement('button');
                    btn.className = `pagination-btn ${i === currentPageNum ? 'active' : ''}`;
                    btn.textContent = i;
                    btn.addEventListener('click', () => {
                        currentPageNum = i;
                        renderCoursesWithPagination();
                    });
                    pageButtons.appendChild(btn);
                }
            }

            function filterCourses() {
                const searchTerm = searchInput.value.trim().toLowerCase();
                const selectedYear = yearFilter.value;

                filteredCourses = allCourses.filter(course => {
                    // å¹´ä»½ç­›é€‰
                    if (selectedYear && (!course.year || course.year.toString() !== selectedYear)) {
                        return false;
                    }

                    // å…³é”®è¯æœç´¢
                    if (!searchTerm) {
                        return true;
                    }

                    return (course.courseName && course.courseName.toLowerCase().includes(searchTerm)) ||
                        (course.courseType && course.courseType.toLowerCase().includes(searchTerm)) ||
                        (course.school && course.school.toLowerCase().includes(searchTerm));
                });

                renderCoursesWithPagination();
            }


        });
    </script>


</body>

</html>